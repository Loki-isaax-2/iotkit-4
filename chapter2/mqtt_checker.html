<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Touch phat Sample</title>
    <link href="https://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/pure-min.css" integrity="sha384-nn4HPE8lTHyVtfCBi5yW9d20FjT8BJwUXyWZT9InLYax14RDjBj46LmSztkmNP9w" crossorigin="anonymous">
    <link rel="shortcut icon" type="image/png" href="https://isaax.io/assets/images/favicon.ico">
    <style type="text/css">
        body {
            background-color: #442f94;
            color: #fff;
            font-family: 'Ubuntu', sans-serif;
            font-weight: bold;
        }
        #mainimage {
            width:100%;
            padding: 2em 0 1em;
            text-align: center;
        }
        #mainimage svg {
            width: 6em;
        }
        #app {
            max-width: 800px;
        }
        form input{
            color: #333;
        }
    </style>
</head>
<body>
<div id="mainimage">
    <svg version="1.1" id="layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px"
         y="0px" viewBox="0 0 300 300" style="enable-background:new 0 0 300 300;" xml:space="preserve">
        <style type="text/css">.st0{fill:#FFFFFF;}</style>
        <path class="st0" d="M123.5,133.5c0,7.9-6.4,14.3-14.3,14.3s-14.3-6.4-14.3-14.3s6.4-14.3,14.3-14.3S123.5,125.6,123.5,133.5z M197.2,119.2c-7.9,0-14.3,6.4-14.3,14.3s6.4,14.3,14.3,14.3c7.9,0,14.3-6.4,14.3-14.3S205.1,119.2,197.2,119.2z M57.4,83.4 c-0.3-0.3-0.8-0.5-1.2-0.5c-0.1,0-0.3,0-0.4,0.1c-23.1,6.4-39.3,27.6-39.3,51.6c0,10.9,3.3,21.4,9.4,30.4c0.3,0.4,0.8,0.7,1.4,0.7 c0.1,0,0.1,0,0.2,0c0.6-0.1,1.1-0.5,1.4-1.1l28.9-79.4C57.9,84.5,57.8,83.8,57.4,83.4z M167.5,133.5c0-16.4,13.3-29.7,29.7-29.7 c0.4,0,0.9,0,1.4,0h0.1c0.7,0,1.3-0.4,1.6-1.1l3.3-9.2c0-0.1,0.1-0.2,0.1-0.4c0.5-1.8,0.7-3.7,0.7-5.6c0-11.8-9.6-21.4-21.4-21.4 c-2.4,0-4.7,0.4-6.9,1.1l0,0c-0.1,0.1-0.3,0.1-0.5,0.1c-0.3,0-0.5-0.1-0.8-0.2c-0.4-0.2-0.6-0.6-0.6-1V66 c-1.4-12.8-7.8-24.7-17.8-33c-0.3-0.2-0.7-0.4-1.1-0.4c-0.1,0-0.3,0-0.4,0c-0.5,0.1-0.9,0.5-1.1,1L126.7,108c-0.2,0.7,0,1.5,0.6,1.9 c7.3,5.6,11.7,14.4,11.7,23.6c0,16.4-13.3,29.7-29.7,29.7c-0.4,0-0.9,0-1.3,0h-0.1c-0.7,0-1.3,0.4-1.6,1.1l-7.8,21.5 c-0.2,0.5-0.1,1.1,0.2,1.5c0.3,0.4,0.8,0.7,1.4,0.7h68c0.7,0,1.3-0.4,1.5-1.1l10.2-27.9c0.2-0.7,0-1.5-0.6-1.9 C171.8,151.5,167.5,142.7,167.5,133.5z M79.5,133.5c0-16.4,13.3-29.7,29.7-29.7c0.4,0,0.9,0,1.3,0h0.1c0.7,0,1.3-0.4,1.6-1.1 l28-76.9c0.1-0.4,0.1-0.9-0.1-1.3c-0.2-0.4-0.6-0.7-1-0.9c-4.7-1.4-9.6-2.2-14.5-2.2c-27.6,0-50,22.4-50,49.9c0,3,0.3,6.1,0.8,9.1 c0.1,0.6,0,1.2,0,1.2l-34.9,95.9c-0.3,0.7,0,1.6,0.7,2c8.6,5.5,18.6,8.4,28.8,8.4h10c0.7,0,1.3-0.4,1.6-1.1L91.7,159 c0.3-0.7,0-1.5-0.6-1.9C83.8,151.5,79.5,142.7,79.5,133.5z M279,106.2c-0.3-0.4-0.8-0.6-1.3-0.6c-0.1,0-0.2,0-0.3,0 c-0.6,0.1-1.1,0.5-1.3,1.1l-28.5,78.2c-0.2,0.6-0.1,1.2,0.3,1.7c0.3,0.4,0.8,0.6,1.3,0.6c0.1,0,0.2,0,0.3,0 c23.4-4.7,40.4-25.5,40.4-49.4C289.9,126.2,286,115,279,106.2z M263.1,93c-7.2-3.8-15.4-5.8-23.5-5.8c-6.1,0-12.1,1.1-17.8,3.2 c-0.5,0.2-0.8,0.5-1,1l-6,16.6c-0.2,0.7,0,1.5,0.6,1.9c7.3,5.6,11.7,14.4,11.7,23.6c0,16.4-13.3,29.7-29.7,29.7c-0.4,0-0.8,0-1.3,0 c0,0,0,0-0.1,0c-0.7,0-1.3,0.4-1.6,1.1l-7.8,21.5c-0.2,0.5-0.1,1.1,0.2,1.5s0.8,0.7,1.4,0.7h40.9c0.7,0,1.3-0.4,1.6-1.1L263.9,95 C264.1,94.2,263.8,93.4,263.1,93z"/>
        <g><path class="st0" d="M33.4,213.5c0,0.8-0.6,1.4-1.4,1.4h-9c-0.8,0-1.4-0.6-1.4-1.4v-8.9c0-0.8,0.6-1.4,1.4-1.4h9 c0.8,0,1.4,0.6,1.4,1.4V213.5z M33.4,228c0-0.8-0.6-1.4-1.4-1.4h-9c-0.8,0-1.4,0.6-1.4,1.4v53.6c0,0.8,0.6,1.4,1.4,1.4h9 c0.8,0,1.4-0.6,1.4-1.4V228z"/> <path class="st0" d="M61,240.4c2.4-1.1,5.8-2,10-2h24.4c0.8,0,1.4-0.6,1.4-1.4v-9c0-0.8-0.6-1.4-1.4-1.4H71 c-14.7,0-25.8,7.6-25.8,17.6v2.7c0,0.6,0.3,1,0.9,1.3l35,18.5c0.4,0.2,0.7,0.7,0.7,1.2s-0.3,1-0.8,1.2c-2.4,1.1-5.8,2-10,2H46.5 c-0.8,0-1.4,0.6-1.4,1.4v8.9c0,0.8,0.6,1.4,1.4,1.4H71c14.8,0,25.9-7.6,25.9-17.6v-2.7c0-0.6-0.4-1-0.9-1.3l-35-18.5 c-0.4-0.2-0.7-0.7-0.7-1.2C60.2,241.1,60.5,240.6,61,240.4z"/> <path class="st0" d="M134.4,226.6H110c-0.8,0-1.4,0.6-1.4,1.4v8.9c0,0.8,0.6,1.4,1.4,1.4h24.4c8.7,0,14.1,3.8,14.1,5.9v21.1 c0,2.1-5.4,5.9-14.1,5.9h-12.7c-0.8,0-1.4-0.6-1.4-1.4v-3.3c0-2.1,5.3-5.9,14.1-5.9h8c0.8,0,1.4-0.6,1.4-1.4v-8.9 c0-0.8-0.6-1.4-1.4-1.4h-8c-14.7,0-25.8,7.6-25.8,17.6v15c0,0.8,0.6,1.4,1.4,1.4h24.4c14.7,0,25.8-7.6,25.8-17.6v-21.1 C160.2,234.2,149.1,226.6,134.4,226.6z"/> <path class="st0" d="M196.9,226.6h-24.4c-0.8,0-1.4,0.6-1.4,1.4v8.9c0,0.8,0.6,1.4,1.4,1.4h24.4c8.8,0,14.1,3.8,14.1,5.9v21.1 c0,2.1-5.3,5.9-14.1,5.9h-12.7c-0.8,0-1.4-0.6-1.4-1.4v-3.3c0-2.1,5.4-5.9,14.1-5.9h8c0.8,0,1.4-0.6,1.4-1.4v-8.9 c0-0.8-0.6-1.4-1.4-1.4h-8c-14.7,0-25.8,7.6-25.8,17.6v15c0,0.8,0.6,1.4,1.4,1.4h24.4c14.7,0,25.8-7.6,25.8-17.6v-21.1 C222.7,234.2,211.6,226.6,196.9,226.6z"/> <path class="st0" d="M284.7,281.6c0,0.8-0.6,1.4-1.4,1.4h-9c-0.7,0-1.3-0.6-1.4-1.3l0,0c-0.3-6.3-2.6-10.7-4.5-12.2l-4.3-3.3 c-0.3-0.3-0.5-0.7-0.5-1.1s0.2-0.8,0.5-1.1l7.5-5.7c0.2-0.1,0.5-0.2,0.8-0.2s0.6,0.1,0.9,0.3l2.2,1.7 C280.9,264.2,284.4,272.1,284.7,281.6L284.7,281.6z M233,228c0.3,9.5,3.9,17.4,9.2,21.4l2.2,1.7c0.3,0.2,0.6,0.3,0.9,0.3 c0.3,0,0.5-0.1,0.8-0.2l7.5-5.7c0.3-0.3,0.5-0.7,0.5-1.1c0-0.4-0.2-0.8-0.5-1.1l-4.3-3.2c-1.9-1.5-4.2-5.9-4.5-12.2l0,0 c0-0.7-0.6-1.3-1.4-1.3h-9C233.7,226.6,233,227.3,233,228L233,228z M283.3,226.6h-8.9c-0.8,0-1.4,0.6-1.4,1.4l0,0 c-0.3,6.1-2.4,10.3-4.3,11.9l-26.5,20.2c-5.3,4.1-8.8,11.9-9.1,21.4l0,0c0,0.8,0.6,1.4,1.4,1.4h8.9c0.8,0,1.4-0.6,1.4-1.4l0,0 c0.3-6.3,2.6-10.6,4.5-12.1l26.3-20c5.3-4.1,8.8-11.9,9.1-21.4l0,0C284.7,227.2,284.1,226.6,283.3,226.6z"/>
        </g>
    </svg>
    <h1 id="name">Touch pHAT</h1>
</div>
<div class="container">
    <div id="app">
        <form
            class="pure-form pure-form-aligned"
            @submit="connect"
            action=""
            method="post"
        >
            <div class="row">
                <fieldset>
                    <div class="pure-control-group">
                        <label for="hostname">Hostname :</label>
                        <input id="hostname" type="text" v-model="hostname" placeholder="hostname" />
                    </div>

                    <div class="pure-control-group">
                        <label for="port">Port :</label>
                        <input id="port" type="number" v-model="port" placeholder="port" />
                    </div>

                    <div class="pure-control-group">
                        <label for="username">Username :</label>
                        <input id="username" type="text" v-model="username" placeholder="username" />
                    </div>

                    <div class="pure-control-group">
                        <label for="password">Password :</label>
                        <input id="password" type="text" v-model="password" placeholder="password" />
                    </div>
                    <div class="pure-controls">
                        <input class="pure-button" type="submit" value="connect"/>
                    </div>
                </fieldset>
            </div>
        </form>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/notify/0.4.2/notify.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.2/mqttws31.min.js"></script>
<script type="text/javascript">

var app = new Vue({
  el: '#app',
  delimiters: ["[[", "]]"],
  data: {
    hostname: "",
    port: 0,
    username: '',
    password: ''
  },
  beforeMount () {
  },
  methods: {
    connect: (e) => {
        e.preventDefault();
        let client_id = 'client_' + Math.floor(Math.random() * 10000)

        app.client = new Paho.MQTT.Client(app.hostname, Number(app.port), client_id);
        app.client.onConnectionLost = app.onConnectionLost;
        app.client.onMessageArrived = app.onMessageArrived;

        var options = {
            useSSL: true,
            userName: app.username,
            password: app.password,
            onSuccess: app.onConnect,
            onFailure: app.doFail
        }

        app.client.connect(options);
    },
    onConnect: () => {
        $('#app').notify('Connection Success!', 'success')

        app.client.subscribe("button");

        let message = new Paho.MQTT.Message("YES");
        message.destinationName = "/browser";

        app.client.send(message);
    },
    doFail: () => {
        $('#app').notify('Connection Failed.', 'error')
    },
    onConnectionLost: (responseObject) => {
        if (responseObject.errorCode !== 0) {
            $('#app').notify('Connection Lost!'+responseObject.errorMessage, 'warn')
        }
    },
    onMessageArrived: (message) => {
        console.log(message)
        let sytle = 'success';

        if(message.payloadString == 'A') {
            style = 'success';
        }
        else if(message.payloadString == 'B') {
            style = 'info';
        }
        else if(message.payloadString == 'C') {
            style = 'warn';
        }
        else if(message.payloadString == 'D') {
            style = 'error';
        }
        $.notify('button ' + message.payloadString + ' pusshed!', style);
    }
  }
})
</script>
</body>
</html>
